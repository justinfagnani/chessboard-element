/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const e=new WeakMap,t=t=>(...s)=>{const i=t(...s);return e.set(i,!0),i},s=t=>"function"==typeof t&&e.has(t),i=void 0!==window.customElements&&void 0!==window.customElements.polyfillWrapFlushCallback,r=(e,t,s=null)=>{for(;t!==s;){const s=t.nextSibling;e.removeChild(t),t=s}},n={},o={},a=`{{lit-${String(Math.random()).slice(2)}}}`,c=`\x3c!--${a}--\x3e`,h=new RegExp(`${a}|${c}`),p="$lit$";class d{constructor(e,t){this.parts=[],this.element=t;const s=[],i=[],r=document.createTreeWalker(t.content,133,null,!1);let n=0,o=-1,c=0;const{strings:d,values:{length:u}}=e;for(;c<u;){const e=r.nextNode();if(null!==e){if(o++,1===e.nodeType){if(e.hasAttributes()){const t=e.attributes,{length:s}=t;let i=0;for(let e=0;e<s;e++)l(t[e].name,p)&&i++;for(;i-- >0;){const t=d[c],s=_.exec(t)[2],i=s.toLowerCase()+p,r=e.getAttribute(i);e.removeAttribute(i);const n=r.split(h);this.parts.push({type:"attribute",index:o,name:s,strings:n}),c+=n.length-1}}"TEMPLATE"===e.tagName&&(i.push(e),r.currentNode=e.content)}else if(3===e.nodeType){const t=e.data;if(t.indexOf(a)>=0){const i=e.parentNode,r=t.split(h),n=r.length-1;for(let t=0;t<n;t++){let s,n=r[t];if(""===n)s=g();else{const e=_.exec(n);null!==e&&l(e[2],p)&&(n=n.slice(0,e.index)+e[1]+e[2].slice(0,-p.length)+e[3]),s=document.createTextNode(n)}i.insertBefore(s,e),this.parts.push({type:"node",index:++o})}""===r[n]?(i.insertBefore(g(),e),s.push(e)):e.data=r[n],c+=n}}else if(8===e.nodeType)if(e.data===a){const t=e.parentNode;null!==e.previousSibling&&o!==n||(o++,t.insertBefore(g(),e)),n=o,this.parts.push({type:"node",index:o}),null===e.nextSibling?e.data="":(s.push(e),o--),c++}else{let t=-1;for(;-1!==(t=e.data.indexOf(a,t+1));)this.parts.push({type:"node",index:-1}),c++}}else r.currentNode=i.pop()}for(const e of s)e.parentNode.removeChild(e)}}const l=(e,t)=>{const s=e.length-t.length;return s>=0&&e.slice(s)===t},u=e=>-1!==e.index,g=()=>document.createComment(""),_=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class m{constructor(e,t,s){this.__parts=[],this.template=e,this.processor=t,this.options=s}update(e){let t=0;for(const s of this.__parts)void 0!==s&&s.setValue(e[t]),t++;for(const e of this.__parts)void 0!==e&&e.commit()}_clone(){const e=i?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),t=[],s=this.template.parts,r=document.createTreeWalker(e,133,null,!1);let n,o=0,a=0,c=r.nextNode();for(;o<s.length;)if(n=s[o],u(n)){for(;a<n.index;)a++,"TEMPLATE"===c.nodeName&&(t.push(c),r.currentNode=c.content),null===(c=r.nextNode())&&(r.currentNode=t.pop(),c=r.nextNode());if("node"===n.type){const e=this.processor.handleTextExpression(this.options);e.insertAfterNode(c.previousSibling),this.__parts.push(e)}else this.__parts.push(...this.processor.handleAttributeExpressions(c,n.name,n.strings,this.options));o++}else this.__parts.push(void 0),o++;return i&&(document.adoptNode(e),customElements.upgrade(e)),e}}
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const f=` ${a} `;class v{constructor(e,t,s,i){this.strings=e,this.values=t,this.type=s,this.processor=i}getHTML(){const e=this.strings.length-1;let t="",s=!1;for(let i=0;i<e;i++){const e=this.strings[i],r=e.lastIndexOf("\x3c!--");s=(r>-1||s)&&-1===e.indexOf("--\x3e",r+1);const n=_.exec(e);t+=null===n?e+(s?f:c):e.substr(0,n.index)+n[1]+n[2]+p+n[3]+a}return t+=this.strings[e],t}getTemplateElement(){const e=document.createElement("template");return e.innerHTML=this.getHTML(),e}}
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const y=e=>null===e||!("object"==typeof e||"function"==typeof e),P=e=>Array.isArray(e)||!(!e||!e[Symbol.iterator]);class b{constructor(e,t,s){this.dirty=!0,this.element=e,this.name=t,this.strings=s,this.parts=[];for(let e=0;e<s.length-1;e++)this.parts[e]=this._createPart()}_createPart(){return new S(this)}_getValue(){const e=this.strings,t=e.length-1;let s="";for(let i=0;i<t;i++){s+=e[i];const t=this.parts[i];if(void 0!==t){const e=t.value;if(y(e)||!P(e))s+="string"==typeof e?e:String(e);else for(const t of e)s+="string"==typeof t?t:String(t)}}return s+=e[t],s}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}}class S{constructor(e){this.value=void 0,this.committer=e}setValue(e){e===n||y(e)&&e===this.value||(this.value=e,s(e)||(this.committer.dirty=!0))}commit(){for(;s(this.value);){const e=this.value;this.value=n,e(this)}this.value!==n&&this.committer.commit()}}class w{constructor(e){this.value=void 0,this.__pendingValue=void 0,this.options=e}appendInto(e){this.startNode=e.appendChild(g()),this.endNode=e.appendChild(g())}insertAfterNode(e){this.startNode=e,this.endNode=e.nextSibling}appendIntoPart(e){e.__insert(this.startNode=g()),e.__insert(this.endNode=g())}insertAfterPart(e){e.__insert(this.startNode=g()),this.endNode=e.endNode,e.endNode=this.startNode}setValue(e){this.__pendingValue=e}commit(){for(;s(this.__pendingValue);){const e=this.__pendingValue;this.__pendingValue=n,e(this)}const e=this.__pendingValue;e!==n&&(y(e)?e!==this.value&&this.__commitText(e):e instanceof v?this.__commitTemplateResult(e):e instanceof Node?this.__commitNode(e):P(e)?this.__commitIterable(e):e===o?(this.value=o,this.clear()):this.__commitText(e))}__insert(e){this.endNode.parentNode.insertBefore(e,this.endNode)}__commitNode(e){this.value!==e&&(this.clear(),this.__insert(e),this.value=e)}__commitText(e){const t=this.startNode.nextSibling,s="string"==typeof(e=null==e?"":e)?e:String(e);t===this.endNode.previousSibling&&3===t.nodeType?t.data=s:this.__commitNode(document.createTextNode(s)),this.value=e}__commitTemplateResult(e){const t=this.options.templateFactory(e);if(this.value instanceof m&&this.value.template===t)this.value.update(e.values);else{const s=new m(t,e.processor,this.options),i=s._clone();s.update(e.values),this.__commitNode(i),this.value=s}}__commitIterable(e){Array.isArray(this.value)||(this.value=[],this.clear());const t=this.value;let s,i=0;for(const r of e)s=t[i],void 0===s&&(s=new w(this.options),t.push(s),0===i?s.appendIntoPart(this):s.insertAfterPart(t[i-1])),s.setValue(r),s.commit(),i++;i<t.length&&(t.length=i,this.clear(s&&s.endNode))}clear(e=this.startNode){r(this.startNode.parentNode,e.nextSibling,this.endNode)}}class x{constructor(e,t,s){if(this.value=void 0,this.__pendingValue=void 0,2!==s.length||""!==s[0]||""!==s[1])throw new Error("Boolean attributes can only contain a single expression");this.element=e,this.name=t,this.strings=s}setValue(e){this.__pendingValue=e}commit(){for(;s(this.__pendingValue);){const e=this.__pendingValue;this.__pendingValue=n,e(this)}if(this.__pendingValue===n)return;const e=!!this.__pendingValue;this.value!==e&&(e?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=e),this.__pendingValue=n}}class q extends b{constructor(e,t,s){super(e,t,s),this.single=2===s.length&&""===s[0]&&""===s[1]}_createPart(){return new E(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}}class E extends S{}let C=!1;try{const e={get capture(){return C=!0,!1}};window.addEventListener("test",e,e),window.removeEventListener("test",e,e)}catch(e){}class N{constructor(e,t,s){this.value=void 0,this.__pendingValue=void 0,this.element=e,this.eventName=t,this.eventContext=s,this.__boundHandleEvent=e=>this.handleEvent(e)}setValue(e){this.__pendingValue=e}commit(){for(;s(this.__pendingValue);){const e=this.__pendingValue;this.__pendingValue=n,e(this)}if(this.__pendingValue===n)return;const e=this.__pendingValue,t=this.value,i=null==e||null!=t&&(e.capture!==t.capture||e.once!==t.once||e.passive!==t.passive),r=null!=e&&(null==t||i);i&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),r&&(this.__options=$(e),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=e,this.__pendingValue=n}handleEvent(e){"function"==typeof this.value?this.value.call(this.eventContext||this.element,e):this.value.handleEvent(e)}}const $=e=>e&&(C?{capture:e.capture,passive:e.passive,once:e.once}:e.capture);
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const k=new class{handleAttributeExpressions(e,t,s,i){const r=t[0];if("."===r){return new q(e,t.slice(1),s).parts}return"@"===r?[new N(e,t.slice(1),i.eventContext)]:"?"===r?[new x(e,t.slice(1),s)]:new b(e,t,s).parts}handleTextExpression(e){return new w(e)}};
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */function T(e){let t=O.get(e.type);void 0===t&&(t={stringsArray:new WeakMap,keyString:new Map},O.set(e.type,t));let s=t.stringsArray.get(e.strings);if(void 0!==s)return s;const i=e.strings.join(a);return s=t.keyString.get(i),void 0===s&&(s=new d(e,e.getTemplateElement()),t.keyString.set(i,s)),t.stringsArray.set(e.strings,s),s}const O=new Map,A=new WeakMap;
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.1.2");const R=(e,...t)=>new v(e,t,"html",k),U=133;
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */function V(e,t){const{element:{content:s},parts:i}=e,r=document.createTreeWalker(s,U,null,!1);let n=D(i),o=i[n],a=-1,c=0;const h=[];let p=null;for(;r.nextNode();){a++;const e=r.currentNode;for(e.previousSibling===p&&(p=null),t.has(e)&&(h.push(e),null===p&&(p=e)),null!==p&&c++;void 0!==o&&o.index===a;)o.index=null!==p?-1:o.index-c,n=D(i,n),o=i[n]}h.forEach(e=>e.parentNode.removeChild(e))}const B=e=>{let t=11===e.nodeType?0:1;const s=document.createTreeWalker(e,U,null,!1);for(;s.nextNode();)t++;return t},D=(e,t=-1)=>{for(let s=t+1;s<e.length;s++){const t=e[s];if(u(t))return s}return-1};
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const z=(e,t)=>`${e}--${t}`;let L=!0;void 0===window.ShadyCSS?L=!1:void 0===window.ShadyCSS.prepareTemplateDom&&(console.warn("Incompatible ShadyCSS version detected. Please update to at least @webcomponents/webcomponentsjs@2.0.2 and @webcomponents/shadycss@1.3.1."),L=!1);const j=e=>t=>{const s=z(t.type,e);let i=O.get(s);void 0===i&&(i={stringsArray:new WeakMap,keyString:new Map},O.set(s,i));let r=i.stringsArray.get(t.strings);if(void 0!==r)return r;const n=t.strings.join(a);if(r=i.keyString.get(n),void 0===r){const s=t.getTemplateElement();L&&window.ShadyCSS.prepareTemplateDom(s,e),r=new d(t,s),i.keyString.set(n,r)}return i.stringsArray.set(t.strings,r),r},M=["html","svg"],W=new Set,I=(e,t,s)=>{W.add(e);const i=s?s.element:document.createElement("template"),r=t.querySelectorAll("style"),{length:n}=r;if(0===n)return void window.ShadyCSS.prepareTemplateStyles(i,e);const o=document.createElement("style");for(let e=0;e<n;e++){const t=r[e];t.parentNode.removeChild(t),o.textContent+=t.textContent}(e=>{M.forEach(t=>{const s=O.get(z(t,e));void 0!==s&&s.keyString.forEach(e=>{const{element:{content:t}}=e,s=new Set;Array.from(t.querySelectorAll("style")).forEach(e=>{s.add(e)}),V(e,s)})})})(e);const a=i.content;s?function(e,t,s=null){const{element:{content:i},parts:r}=e;if(null==s)return void i.appendChild(t);const n=document.createTreeWalker(i,U,null,!1);let o=D(r),a=0,c=-1;for(;n.nextNode();){for(c++,n.currentNode===s&&(a=B(t),s.parentNode.insertBefore(t,s));-1!==o&&r[o].index===c;){if(a>0){for(;-1!==o;)r[o].index+=a,o=D(r,o);return}o=D(r,o)}}}(s,o,a.firstChild):a.insertBefore(o,a.firstChild),window.ShadyCSS.prepareTemplateStyles(i,e);const c=a.querySelector("style");if(window.ShadyCSS.nativeShadow&&null!==c)t.insertBefore(c.cloneNode(!0),t.firstChild);else if(s){a.insertBefore(o,a.firstChild);const e=new Set;e.add(o),V(s,e)}};window.JSCompiler_renameProperty=(e,t)=>e;const F={toAttribute(e,t){switch(t){case Boolean:return e?"":null;case Object:case Array:return null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){switch(t){case Boolean:return null!==e;case Number:return null===e?null:Number(e);case Object:case Array:return JSON.parse(e)}return e}},X=(e,t)=>t!==e&&(t==t||e==e),Y={attribute:!0,type:String,converter:F,reflect:!1,hasChanged:X},H=Promise.resolve(!0),K=1,J=4,Q=8,G=16,Z=32,ee="finalized";class te extends HTMLElement{constructor(){super(),this._updateState=0,this._instanceProperties=void 0,this._updatePromise=H,this._hasConnectedResolver=void 0,this._changedProperties=new Map,this._reflectingProperties=void 0,this.initialize()}static get observedAttributes(){this.finalize();const e=[];return this._classProperties.forEach((t,s)=>{const i=this._attributeNameForProperty(s,t);void 0!==i&&(this._attributeToPropertyMap.set(i,s),e.push(i))}),e}static _ensureClassProperties(){if(!this.hasOwnProperty(JSCompiler_renameProperty("_classProperties",this))){this._classProperties=new Map;const e=Object.getPrototypeOf(this)._classProperties;void 0!==e&&e.forEach((e,t)=>this._classProperties.set(t,e))}}static createProperty(e,t=Y){if(this._ensureClassProperties(),this._classProperties.set(e,t),t.noAccessor||this.prototype.hasOwnProperty(e))return;const s="symbol"==typeof e?Symbol():`__${e}`;Object.defineProperty(this.prototype,e,{get(){return this[s]},set(t){const i=this[e];this[s]=t,this._requestUpdate(e,i)},configurable:!0,enumerable:!0})}static finalize(){const e=Object.getPrototypeOf(this);if(e.hasOwnProperty(ee)||e.finalize(),this[ee]=!0,this._ensureClassProperties(),this._attributeToPropertyMap=new Map,this.hasOwnProperty(JSCompiler_renameProperty("properties",this))){const e=this.properties,t=[...Object.getOwnPropertyNames(e),..."function"==typeof Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e):[]];for(const s of t)this.createProperty(s,e[s])}}static _attributeNameForProperty(e,t){const s=t.attribute;return!1===s?void 0:"string"==typeof s?s:"string"==typeof e?e.toLowerCase():void 0}static _valueHasChanged(e,t,s=X){return s(e,t)}static _propertyValueFromAttribute(e,t){const s=t.type,i=t.converter||F,r="function"==typeof i?i:i.fromAttribute;return r?r(e,s):e}static _propertyValueToAttribute(e,t){if(void 0===t.reflect)return;const s=t.type,i=t.converter;return(i&&i.toAttribute||F.toAttribute)(e,s)}initialize(){this._saveInstanceProperties(),this._requestUpdate()}_saveInstanceProperties(){this.constructor._classProperties.forEach((e,t)=>{if(this.hasOwnProperty(t)){const e=this[t];delete this[t],this._instanceProperties||(this._instanceProperties=new Map),this._instanceProperties.set(t,e)}})}_applyInstanceProperties(){this._instanceProperties.forEach((e,t)=>this[t]=e),this._instanceProperties=void 0}connectedCallback(){this._updateState=this._updateState|Z,this._hasConnectedResolver&&(this._hasConnectedResolver(),this._hasConnectedResolver=void 0)}disconnectedCallback(){}attributeChangedCallback(e,t,s){t!==s&&this._attributeToProperty(e,s)}_propertyToAttribute(e,t,s=Y){const i=this.constructor,r=i._attributeNameForProperty(e,s);if(void 0!==r){const e=i._propertyValueToAttribute(t,s);if(void 0===e)return;this._updateState=this._updateState|Q,null==e?this.removeAttribute(r):this.setAttribute(r,e),this._updateState=this._updateState&~Q}}_attributeToProperty(e,t){if(this._updateState&Q)return;const s=this.constructor,i=s._attributeToPropertyMap.get(e);if(void 0!==i){const e=s._classProperties.get(i)||Y;this._updateState=this._updateState|G,this[i]=s._propertyValueFromAttribute(t,e),this._updateState=this._updateState&~G}}_requestUpdate(e,t){let s=!0;if(void 0!==e){const i=this.constructor,r=i._classProperties.get(e)||Y;i._valueHasChanged(this[e],t,r.hasChanged)?(this._changedProperties.has(e)||this._changedProperties.set(e,t),!0!==r.reflect||this._updateState&G||(void 0===this._reflectingProperties&&(this._reflectingProperties=new Map),this._reflectingProperties.set(e,r))):s=!1}!this._hasRequestedUpdate&&s&&this._enqueueUpdate()}requestUpdate(e,t){return this._requestUpdate(e,t),this.updateComplete}async _enqueueUpdate(){let e,t;this._updateState=this._updateState|J;const s=this._updatePromise;this._updatePromise=new Promise((s,i)=>{e=s,t=i});try{await s}catch(e){}this._hasConnected||await new Promise(e=>this._hasConnectedResolver=e);try{const e=this.performUpdate();null!=e&&await e}catch(e){t(e)}e(!this._hasRequestedUpdate)}get _hasConnected(){return this._updateState&Z}get _hasRequestedUpdate(){return this._updateState&J}get hasUpdated(){return this._updateState&K}performUpdate(){this._instanceProperties&&this._applyInstanceProperties();let e=!1;const t=this._changedProperties;try{e=this.shouldUpdate(t),e&&this.update(t)}catch(t){throw e=!1,t}finally{this._markUpdated()}e&&(this._updateState&K||(this._updateState=this._updateState|K,this.firstUpdated(t)),this.updated(t))}_markUpdated(){this._changedProperties=new Map,this._updateState=this._updateState&~J}get updateComplete(){return this._getUpdateComplete()}_getUpdateComplete(){return this._updatePromise}shouldUpdate(e){return!0}update(e){void 0!==this._reflectingProperties&&this._reflectingProperties.size>0&&(this._reflectingProperties.forEach((e,t)=>this._propertyToAttribute(t,this[t],e)),this._reflectingProperties=void 0)}updated(e){}firstUpdated(e){}}te[ee]=!0;
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const se=(e,t)=>"method"!==t.kind||!t.descriptor||"value"in t.descriptor?{kind:"field",key:Symbol(),placement:"own",descriptor:{},initializer(){"function"==typeof t.initializer&&(this[t.key]=t.initializer.call(this))},finisher(s){s.createProperty(t.key,e)}}:Object.assign({},t,{finisher(s){s.createProperty(t.key,e)}}),ie=(e,t,s)=>{t.constructor.createProperty(s,e)};function re(e){return(t,s)=>void 0!==s?ie(e,t,s):se(e,t)}const ne=(e,t,s)=>{Object.defineProperty(t,s,e)},oe=(e,t)=>({kind:"method",placement:"prototype",key:t.key,descriptor:e}),ae="adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,ce=Symbol();class he{constructor(e,t){if(t!==ce)throw new Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e}get styleSheet(){return void 0===this._styleSheet&&(ae?(this._styleSheet=new CSSStyleSheet,this._styleSheet.replaceSync(this.cssText)):this._styleSheet=null),this._styleSheet}toString(){return this.cssText}}
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
(window.litElementVersions||(window.litElementVersions=[])).push("2.2.1");const pe=e=>e.flat?e.flat(1/0):function e(t,s=[]){for(let i=0,r=t.length;i<r;i++){const r=t[i];Array.isArray(r)?e(r,s):s.push(r)}return s}(e);class de extends te{static finalize(){super.finalize.call(this),this._styles=this.hasOwnProperty(JSCompiler_renameProperty("styles",this))?this._getUniqueStyles():this._styles||[]}static _getUniqueStyles(){const e=this.styles,t=[];if(Array.isArray(e)){pe(e).reduceRight((e,t)=>(e.add(t),e),new Set).forEach(e=>t.unshift(e))}else e&&t.push(e);return t}initialize(){super.initialize(),this.renderRoot=this.createRenderRoot(),window.ShadowRoot&&this.renderRoot instanceof window.ShadowRoot&&this.adoptStyles()}createRenderRoot(){return this.attachShadow({mode:"open"})}adoptStyles(){const e=this.constructor._styles;0!==e.length&&(void 0===window.ShadyCSS||window.ShadyCSS.nativeShadow?ae?this.renderRoot.adoptedStyleSheets=e.map(e=>e.styleSheet):this._needsShimAdoptedStyleSheets=!0:window.ShadyCSS.ScopingShim.prepareAdoptedCssText(e.map(e=>e.cssText),this.localName))}connectedCallback(){super.connectedCallback(),this.hasUpdated&&void 0!==window.ShadyCSS&&window.ShadyCSS.styleElement(this)}update(e){super.update(e);const t=this.render();t instanceof v&&this.constructor.render(t,this.renderRoot,{scopeName:this.localName,eventContext:this}),this._needsShimAdoptedStyleSheets&&(this._needsShimAdoptedStyleSheets=!1,this.constructor._styles.forEach(e=>{const t=document.createElement("style");t.textContent=e.cssText,this.renderRoot.appendChild(t)}))}render(){}}de.finalized=!0,de.render=(e,t,s)=>{if(!s||"object"!=typeof s||!s.scopeName)throw new Error("The `scopeName` option is required.");const i=s.scopeName,n=A.has(t),o=L&&11===t.nodeType&&!!t.host,a=o&&!W.has(i),c=a?document.createDocumentFragment():t;if(((e,t,s)=>{let i=A.get(t);void 0===i&&(r(t,t.firstChild),A.set(t,i=new w(Object.assign({templateFactory:T},s))),i.appendInto(t)),i.setValue(e),i.commit()})(e,c,Object.assign({templateFactory:j(i)},s)),a){const e=A.get(c);A.delete(c);const s=e.value instanceof m?e.value.template:void 0;I(i,c,s),r(t,t.firstChild),t.appendChild(c),A.set(t,e)}!n&&o&&window.ShadyCSS.styleElement(t.host)};
/**
 * @license
 * Copyright (c) 2018 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const le=new WeakMap,ue=t(e=>t=>{if(!(t instanceof S)||t instanceof E||"style"!==t.committer.name||t.committer.parts.length>1)throw new Error("The `styleMap` directive must be used in the style attribute and must be the only part in the attribute.");const{committer:s}=t,{style:i}=s.element;le.has(t)||(i.cssText=s.strings.join(" "));const r=le.get(t);for(const t in r)t in e||(-1===t.indexOf("-")?i[t]=null:i.removeProperty(t));for(const t in e)-1===t.indexOf("-")?i[t]=e[t]:i.setProperty(t,e[t]);le.set(t,e)}),ge=t(e=>t=>{if(void 0===e&&t instanceof S){if(e!==t.value){const e=t.committer.name;t.committer.element.removeAttribute(e)}}else t.setValue(e)}),_e=e=>"string"==typeof e,me=e=>JSON.parse(JSON.stringify(e)),fe=(e,t)=>{for(const[s,i]of Object.entries(t)){const t="{"+s+"}";for(;e.includes(t);)e=e.replace(t,i)}return e};console.assert("abc"===fe("abc",{a:"x"})),console.assert("{a}bc"===fe("{a}bc",{})),console.assert("{a}bc"===fe("{a}bc",{p:"q"})),console.assert("xbc"===fe("{a}bc",{a:"x"})),console.assert("xbcxbc"===fe("{a}bc{a}bc",{a:"x"})),console.assert("xxy"===fe("{a}{a}{b}",{a:"x",b:"y"}));const ve=((e,...t)=>{const s=t.reduce((t,s,i)=>t+(e=>{if(e instanceof he)return e.cssText;if("number"==typeof e)return e;throw new Error(`Value passed to 'css' function must be a 'css' function result: ${e}. Use 'unsafeCSS' to pass non-literal values, but\n            take care to ensure page security.`)})(s)+e[i+1],e[0]);return new he(s,ce)})`:host{display:block}[part~=board]{border:2px solid #404040;box-sizing:border-box;display:grid;grid-template-columns:repeat(8,12.5%);grid-template-rows:repeat(8,12.5%)}[part~=square]{position:relative;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}[part~=piece]{width:100%;height:100%;z-index:10}[part~=spare-pieces]{display:grid;position:relative;padding:0 2px;grid-template-columns:repeat(8,12.5%)}[part~=dragged-piece]{display:none;position:absolute}[part~=white]{background-color:#f0d9b5;color:#b58863}[part~=black]{background-color:#b58863;color:#f0d9b5}[part~=highlight]{box-shadow:inset 0 0 3px 3px #ff0}[part~=notation]{cursor:default;font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;font-size:14px;position:absolute}[part~=alpha]{bottom:1px;right:3px}[part~=numeric]{top:2px;left:2px}`,ye="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",Pe="abcdefgh".split(""),be=["wK","wQ","wR","wB","wN","wP"],Se=["bK","bQ","bR","bB","bN","bP"],we=e=>e.charCodeAt(0)%2^e.charCodeAt(1)%2?"white":"black",xe=e=>_e(e)&&-1!==e.search(/^[a-h][1-8]$/),qe=e=>{if(!_e(e))return!1;const t=e.split("-");return 2===t.length&&(xe(t[0])&&xe(t[1]))};console.assert(xe("a1")),console.assert(xe("e2")),console.assert(!xe("D2")),console.assert(!xe("g9")),console.assert(!xe("a")),console.assert(!xe(!0)),console.assert(!xe(null)),console.assert(!xe({}));const Ee=e=>_e(e)&&-1!==e.search(/^[bw][KQRNBP]$/);console.assert(Ee("bP")),console.assert(Ee("bK")),console.assert(Ee("wK")),console.assert(Ee("wR")),console.assert(!Ee("WR")),console.assert(!Ee("Wr")),console.assert(!Ee("a")),console.assert(!Ee(!0)),console.assert(!Ee(null)),console.assert(!Ee({}));const Ce=e=>{if(!_e(e))return!1;const t=(e=(e=>e.replace(/8/g,"11111111").replace(/7/g,"1111111").replace(/6/g,"111111").replace(/5/g,"11111").replace(/4/g,"1111").replace(/3/g,"111").replace(/2/g,"11"))(e=e.replace(/ .+$/,""))).split("/");if(8!==t.length)return!1;for(let e=0;e<8;e++)if(8!==t[e].length||-1!==t[e].search(/[^kqrnbpKQRNBP1]/))return!1;return!0};console.assert(Ce(ye)),console.assert(Ce("8/8/8/8/8/8/8/8")),console.assert(Ce("r1bqkbnr/pppp1ppp/2n5/1B2p3/4P3/5N2/PPPP1PPP/RNBQK2R")),console.assert(Ce("3r3r/1p4pp/2nb1k2/pP3p2/8/PB2PN2/p4PPP/R4RK1 b - - 0 1")),console.assert(!Ce("3r3z/1p4pp/2nb1k2/pP3p2/8/PB2PN2/p4PPP/R4RK1 b - - 0 1")),console.assert(!Ce("anbqkbnr/8/8/8/8/8/PPPPPPPP/8")),console.assert(!Ce("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/")),console.assert(!Ce("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBN")),console.assert(!Ce("888888/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR")),console.assert(!Ce("888888/pppppppp/74/8/8/8/PPPPPPPP/RNBQKBNR")),console.assert(!Ce({}));const Ne=e=>{if("object"!=typeof e||null===e)return!1;for(const[t,s]of Object.entries(e))if(!xe(t)||!Ee(s))return!1;return!0};console.assert(Ne({})),console.assert(Ne({e2:"wP"})),console.assert(Ne({e2:"wP",d2:"wP"})),console.assert(!Ne({e2:"BP"})),console.assert(!Ne({y2:"wP"})),console.assert(!Ne(null)),console.assert(!Ne(void 0)),console.assert(!Ne(1)),console.assert(!Ne("start")),console.assert(!Ne(ye));const $e=e=>e.toLowerCase()===e?"b"+e.toUpperCase():"w"+e.toUpperCase(),ke=e=>{const t=e.split("");return"w"===t[0]?t[1].toUpperCase():t[1].toLowerCase()},Te=e=>{if(!Ce(e))return!1;const t=(e=e.replace(/ .+$/,"")).split("/"),s={};let i=8;for(let e=0;e<8;e++){const r=t[e].split("");let n=0;for(let e=0;e<r.length;e++)if(-1!==r[e].search(/[1-8]/)){n+=parseInt(r[e],10)}else{s[Pe[n]+i]=$e(r[e]),n+=1}i-=1}return s},Oe=Te(ye),Ae=e=>{if(!Ne(e))return!1;let t="",s=8;for(let i=0;i<8;i++){for(let i=0;i<8;i++){const r=Pe[i]+s;e.hasOwnProperty(r)?t+=ke(e[r]):t+="1"}7!==i&&(t+="/"),s-=1}return t=(e=>e.replace(/11111111/g,"8").replace(/1111111/g,"7").replace(/111111/g,"6").replace(/11111/g,"5").replace(/1111/g,"4").replace(/111/g,"3").replace(/11/g,"2"))(t),t};console.assert(Ae(Oe)===ye),console.assert("8/8/8/8/8/8/8/8"===Ae({})),console.assert("8/8/8/8/8/8/Pp6/8"===Ae({a2:"wP",b2:"bP"}));const Re=e=>(_e(e)&&"start"===e.toLowerCase()&&(e=me(Oe)),Ce(e)&&(e=Te(e)),e),Ue=(e,t)=>{const s=e.split(""),i=Pe.indexOf(s[0])+1,r=parseInt(s[1],10),n=t.split(""),o=Pe.indexOf(n[0])+1,a=parseInt(n[1],10),c=Math.abs(i-o),h=Math.abs(r-a);return c>=h?c:h},Ve=(e,t,s)=>{const i=(e=>{const t=[];for(let s=0;s<8;s++)for(let i=0;i<8;i++){const r=Pe[s]+(i+1);e!==r&&t.push({square:r,distance:Ue(e,r)})}t.sort((function(e,t){return e.distance-t.distance}));const s=[];for(let e=0;e<t.length;e++)s.push(t[e].square);return s})(s);for(let s=0;s<i.length;s++){const r=i[s];if(e.hasOwnProperty(r)&&e[r]===t)return r}return!1},Be=(e,t)=>{const s=me(e);for(const e in t){if(!t.hasOwnProperty(e))continue;if(!s.hasOwnProperty(e))continue;const i=s[e];delete s[e],s[t[e]]=i}return s};var De=function(e,t,s,i){var r,n=arguments.length,o=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,s,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(n<3?r(o):n>3?r(t,s,o):r(t,s))||o);return n>3&&o&&Object.defineProperty(t,s,o),o};function ze(e){var t;if("dragging"!==(null===(t=e)||void 0===t?void 0:t.state))throw new Error(`unexpected drag state ${JSON.stringify(e)}`)}const Le=e=>"number"==typeof e?e:"fast"===e?200:"slow"===e?600:parseInt(e,10),je=e=>`square-${e}`,Me=e=>`spare-piece-${e}`,We=e=>new URL(`../chesspieces/wikipedia/${e}.png`,import.meta.url).href;let Ie=class extends de{constructor(){super(...arguments),this.hideNotation=!1,this.orientation="white",this.draggablePieces=!1,this.dropOffBoard="snapback",this.pieceTheme=We,this.moveSpeed=200,this.snapbackSpeed=60,this.snapSpeed=30,this.trashSpeed=100,this.appearSpeed=200,this.sparePieces=!1,this._highlightedSquares=new Set,this._animations=new Map,this._currentPosition={},this._mousemoveWindow=e=>{var t;"dragging"===(null===(t=this._dragState)||void 0===t?void 0:t.state)&&this._updateDraggedPiece(e.clientX,e.clientY,e.pageX,e.pageY)},this._mouseupWindow=e=>{var t;if("dragging"!==(null===(t=this._dragState)||void 0===t?void 0:t.state))return;const s=this._isXYOnSquare(e.clientX,e.clientY);this._stopDraggedPiece(s)},this._touchmoveWindow=e=>{var t;if("dragging"!==(null===(t=this._dragState)||void 0===t?void 0:t.state))return;e.preventDefault();const s=e.changedTouches[0];this._updateDraggedPiece(s.clientX,s.clientY,s.pageX,s.pageY)},this._touchendWindow=e=>{var t;if("dragging"!==(null===(t=this._dragState)||void 0===t?void 0:t.state))return;const s=this._isXYOnSquare(e.changedTouches[0].clientX,e.changedTouches[0].clientY);this._stopDraggedPiece(s)}}get position(){return this._currentPosition}set position(e){const t=this._currentPosition;this._setCurrentPosition(e),this.requestUpdate("position",t)}get showNotation(){return!this.hideNotation}set showNotation(e){this.hideNotation=!e}get _squareSize(){return this.offsetWidth/8}_getSquareElement(e){return this.shadowRoot.getElementById(je(e))}_getSparePieceElement(e){return this.shadowRoot.getElementById(Me(e))}render(){return R`<div part=spare-pieces>${this._renderSparePieces("white"===this.orientation?"black":"white")}</div>${this._renderBoard()}<div part=spare-pieces>${this._renderSparePieces("white"===this.orientation?"white":"black")}</div><div id=dragged-pieces style=${ue({width:`${this._squareSize}px`,height:`${this._squareSize}px`})}>${this._renderDraggedPiece()}</div>`}_renderSparePieces(e){if(!this.sparePieces)return o;return R`<div></div>${("black"===e?Se:be).map(e=>R`<div id=spare-${e} @mousedown=${this._mousedownSparePiece} @touchstart=${this._touchstartSparePiece}>${this._renderPiece(e,{},!1,Me(e))}</div>`)}<div></div>`}_renderDraggedPiece(){var e,t;const s={height:`${this._squareSize}px`,width:`${this._squareSize}px`},i=this._dragState;if(void 0!==i)if(s.display="block","dragging"===i.state){const{x:e,y:t}=i;Object.assign(s,{top:`${t-this._squareSize/2}px`,left:`${e-this._squareSize/2}px`})}else if("snapback"===i.state){const{source:e}=i,t=this._getSquareElement(e).getBoundingClientRect();Object.assign(s,{transitionProperty:"top, left",transitionDuration:`${Le(this.snapbackSpeed)}ms`,top:`${t.top}px`,left:`${t.left}px`})}else if("trash"===i.state){const{x:e,y:t}=i;Object.assign(s,{transitionProperty:"opacity",transitionDuration:`${Le(this.trashSpeed)}ms`,opacity:"0",top:`${t-this._squareSize/2}px`,left:`${e-this._squareSize/2}px`})}else if("snap"===i.state){const e=this._getSquareElement(i.location).getBoundingClientRect();Object.assign(s,{transitionProperty:"top, left",transitionDuration:`${Le(this.snapSpeed)}ms`,top:`${e.top}px`,left:`${e.left}px`})}return this._renderPiece(null!=(t=null===(e=this._dragState)||void 0===e?void 0:e.piece)?t:"",s,!1,void 0,"dragged-piece")}_renderBoard(){var e,t;const s=[],i="black"===this.orientation;for(let r=0;r<8;r++)for(let n=0;n<8;n++){const a=Pe[i?7-n:n],c=i?r+1:8-r,h=`${a}${c}`,p=we(h);let d=this._currentPosition[h];const l=h===(null===(e=this._dragState)||void 0===e?void 0:e.source),u=this._animations.get(h),g=l||this._highlightedSquares.has(h)?"highlight":"",_=this._getAnimationStyles(d,u);d||"clear"!==(null===(t=u)||void 0===t?void 0:t.type)||(d=u.piece),s.push(R`<div class=square id=${je(h)} data-square=${h} part="square ${h} ${p} ${g}" @mousedown=${this._mousedownSquare} @mouseenter=${this._mouseenterSquare} @mouseleave=${this._mouseleaveSquare} @touchstart=${this._touchstartSquare}>${this.showNotation&&7===r?R`<div part="notation alpha">${a}</div>`:o} ${this.showNotation&&0===n?R`<div part="notation numeric">${c}</div>`:o} ${this._renderPiece(d,_,l)}</div>`)}const r={width:8*this._squareSize+"px",height:8*this._squareSize+"px"};return R`<div part=board style=${ue(r)}>${s}</div>`}_renderPiece(e,t,s,i,r){if(void 0===e)return o;const n=Object.assign({opacity:"1",transitionProperty:"",transitionDuration:"0ms"},t);(s||""===e)&&(n.display="none");const a=""===e?void 0:this._getPieceImgSrc(e);return R`<img id=${ge(i)} src=${null!=a?a:""} part="piece ${null!=r?r:""}" piece=${e} style=${ue(n)}>`}_getAnimationStyles(e,t){if(t){if(e&&("move-start"===t.type||"add-start"===t.type&&this.draggablePieces)){const s="move-start"===t.type?this._getSquareElement(t.source):this._getSparePieceElement(e),i="move-start"===t.type?this._getSquareElement(t.destination):this._getSquareElement(t.square),r=s.getBoundingClientRect(),n=i.getBoundingClientRect();return{position:"absolute",left:`${r.left-n.left}px`,top:`${r.top-n.top}px`,width:`${this._squareSize}px`,height:`${this._squareSize}px`}}if(e&&("move"===t.type||"add"===t.type&&this.draggablePieces))return{position:"absolute",transitionProperty:"top, left",transitionDuration:`${Le(this.moveSpeed)}ms`,top:"0",left:"0",width:`${this._squareSize}px`,height:`${this._squareSize}px`};if(!e&&"clear"===t.type)return e=t.piece,{transitionProperty:"opacity",transitionDuration:`${Le(this.trashSpeed)}ms`,opacity:"0"};if(e&&"add-start"===t.type)return{opacity:"0"};if(e&&"add"===t.type)return{transitionProperty:"opacity",transitionDuration:`${Le(this.appearSpeed)}ms`}}return{}}_getPieceImgSrc(e){return(e=>"function"==typeof e)(this.pieceTheme)?this.pieceTheme(e):_e(this.pieceTheme)?fe(this.pieceTheme,{piece:e}):void this._error(8272,"Unable to build image source for pieceTheme.")}_mousedownSquare(e){if(e.preventDefault(),!this.draggablePieces&&!this.sparePieces)return;const t=e.currentTarget.getAttribute("data-square");null!==t&&this._currentPosition.hasOwnProperty(t)&&this._beginDraggingPiece(t,this._currentPosition[t],e.pageX,e.pageY)}_mousedownSparePiece(e){if(e.preventDefault(),!this.sparePieces)return;const t=e.currentTarget.querySelector("[part~=piece]").getAttribute("piece");this._beginDraggingPiece("spare",t,e.pageX,e.pageY)}_mouseenterSquare(e){if(void 0!==this._dragState)return;const t=e.currentTarget.getAttribute("data-square");if(!xe(t))return;let s=!1;this._currentPosition.hasOwnProperty(t)&&(s=this._currentPosition[t]),this.dispatchEvent(new CustomEvent("mouseover-square",{bubbles:!0,detail:{square:t,piece:s,position:me(this._currentPosition),orientation:this.orientation}}))}_mouseleaveSquare(e){if(void 0!==this._dragState)return;const t=e.currentTarget.getAttribute("data-square");if(!xe(t))return;let s=!1;this._currentPosition.hasOwnProperty(t)&&(s=this._currentPosition[t]),this.dispatchEvent(new CustomEvent("mouseout-square",{bubbles:!0,detail:{square:t,piece:s,position:me(this._currentPosition),orientation:this.orientation}}))}_touchstartSquare(e){if(!this.draggablePieces&&!this.sparePieces)return;const t=e.target.closest("[data-square]").getAttribute("data-square");xe(t)&&this._currentPosition.hasOwnProperty(t)&&(e.preventDefault(),this._beginDraggingPiece(t,this._currentPosition[t],e.changedTouches[0].pageX,e.changedTouches[0].pageY))}_touchstartSparePiece(e){if(!this.sparePieces)return;const t=e.target.closest("[piece]").getAttribute("piece");e.preventDefault(),this._beginDraggingPiece("spare",t,e.changedTouches[0].pageX,e.changedTouches[0].pageY)}setPosition(e,t=!0){if(e=Re(e),!Ne(e))throw this._error(6482,"Invalid value passed to the position method.",e);if(t){const t=this._calculateAnimations(this._currentPosition,e);this._doAnimations(t,this._currentPosition,e)}this._setCurrentPosition(e),this.requestUpdate()}fen(){return Ae(this._currentPosition)}start(e){this.setPosition("start",e)}clear(e){this.setPosition({},e)}move(...e){let t=!0;const s={};for(const i of e){if(!1===i){t=!1;continue}if(!qe(i)){this._error(2826,"Invalid move passed to the move method.",i);continue}const[e,r]=i.split("-");s[e]=r}const i=Be(this._currentPosition,s);return this.setPosition(i,t),i}flip(){this.orientation="white"===this.orientation?"black":"white"}resize(){this.requestUpdate()}firstUpdated(){this.requestUpdate()}connectedCallback(){super.connectedCallback(),window.addEventListener("mousemove",this._mousemoveWindow),window.addEventListener("mouseup",this._mouseupWindow),window.addEventListener("touchmove",this._touchmoveWindow,{passive:!1}),window.addEventListener("touchend",this._touchendWindow,{passive:!1})}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("mousemove",this._mousemoveWindow),window.removeEventListener("mouseup",this._mouseupWindow),window.removeEventListener("touchmove",this._touchmoveWindow),window.removeEventListener("touchend",this._touchendWindow)}_setCurrentPosition(e){const t=me(this._currentPosition),s=me(e);Ae(t)!==Ae(s)&&(this.dispatchEvent(new CustomEvent("change",{bubbles:!0,detail:{value:s,oldValue:t}})),this._currentPosition=e)}_isXYOnSquare(e,t){const s=this.shadowRoot.elementsFromPoint(e,t).find(e=>e.classList.contains("square"));return void 0===s?"offboard":s.getAttribute("data-square")}_highlightSquare(e,t=!0){t?this._highlightedSquares.add(e):this._highlightedSquares.delete(e),this.requestUpdate("_highlightedSquares")}async _snapbackDraggedPiece(){ze(this._dragState);const{source:e,piece:t}=this._dragState;return"spare"===e?this._trashDraggedPiece():(this._dragState={state:"snapback",piece:t,source:e},this.requestUpdate(),await new Promise(e=>setTimeout(e,0)),new Promise(s=>{const i=()=>{this._draggedPieceElement.removeEventListener("transitionend",i),s(),this.dispatchEvent(new CustomEvent("snapback-end",{bubbles:!0,detail:{piece:t,square:e,position:me(this._currentPosition),orientation:this.orientation}}))};this._draggedPieceElement.addEventListener("transitionend",i)}))}async _trashDraggedPiece(){ze(this._dragState);const{source:e,piece:t}=this._dragState,s=me(this._currentPosition);return delete s[e],this._setCurrentPosition(s),this._dragState={state:"trash",piece:t,x:this._dragState.x,y:this._dragState.y,source:this._dragState.source},this.requestUpdate(),await new Promise(e=>setTimeout(e,0)),new Promise(e=>{const t=()=>{this._draggedPieceElement.removeEventListener("transitionend",t),e()};this._draggedPieceElement.addEventListener("transitionend",t)})}async _dropDraggedPieceOnSquare(e){ze(this._dragState);const{source:t,piece:s}=this._dragState,i=me(this._currentPosition);return delete i[t],i[e]=s,this._setCurrentPosition(i),this._dragState={state:"snap",piece:s,location:e,source:e},this.requestUpdate(),await new Promise(e=>setTimeout(e,0)),new Promise(i=>{const r=()=>{this._draggedPieceElement.removeEventListener("transitionend",r),i(),this.dispatchEvent(new CustomEvent("snap-end",{bubbles:!0,detail:{source:t,square:e,piece:s}}))};this._draggedPieceElement.addEventListener("transitionend",r)})}_beginDraggingPiece(e,t,s,i){const r=new CustomEvent("drag-start",{bubbles:!0,cancelable:!0,detail:{source:e,piece:t,position:me(this._currentPosition),orientation:this.orientation}});this.dispatchEvent(r),r.defaultPrevented||(this._dragState={state:"dragging",x:s,y:i,piece:t,location:"spare"===e?"offboard":e,source:e},this.requestUpdate())}_updateDraggedPiece(e,t,s,i){ze(this._dragState),this._dragState.x=s,this._dragState.y=i,this.requestUpdate();const r=this._isXYOnSquare(e,t);r!==this._dragState.location&&(xe(this._dragState.location)&&this._highlightSquare(this._dragState.location,!1),xe(r)&&this._highlightSquare(r),this.dispatchEvent(new CustomEvent("drag-move",{bubbles:!0,detail:{newLocation:r,oldLocation:this._dragState.location,source:this._dragState.source,piece:this._dragState.piece,position:me(this._currentPosition),orientation:this.orientation}})),this._dragState.location=r)}async _stopDraggedPiece(e){ze(this._dragState);const{source:t,piece:s}=this._dragState;let i="drop";"offboard"===e&&(i="trash"===this.dropOffBoard?"trash":"snapback");const r=me(this._currentPosition),n=me(this._currentPosition);"spare"===t&&xe(e)&&(r[e]=s),xe(t)&&(delete r[t],xe(e)&&(r[e]=s));const o=new CustomEvent("drop",{bubbles:!0,detail:{source:t,target:e,piece:s,newPosition:r,oldPosition:n,orientation:this.orientation,setAction(e){i=e}}});this.dispatchEvent(o),this._highlightedSquares.clear(),"snapback"===i?await this._snapbackDraggedPiece():"trash"===i?await this._trashDraggedPiece():"drop"===i&&await this._dropDraggedPieceOnSquare(e),this._dragState=void 0,this.requestUpdate()}_calculateAnimations(e,t){e=me(e),t=me(t);const s=[],i={};for(const s in t)t.hasOwnProperty(s)&&e.hasOwnProperty(s)&&e[s]===t[s]&&(delete e[s],delete t[s]);for(const r in t){if(!t.hasOwnProperty(r))continue;const n=Ve(e,t[r],r);n&&(s.push({type:"move",source:n,destination:r,piece:t[r]}),delete e[n],delete t[r],i[r]=!0)}for(const e in t)t.hasOwnProperty(e)&&(s.push({type:"add",square:e,piece:t[e]}),delete t[e]);for(const t in e)e.hasOwnProperty(t)&&(i.hasOwnProperty(t)||(s.push({type:"clear",square:t,piece:e[t]}),delete e[t]));return s}async _doAnimations(e,t,s){if(0===e.length)return;let i=0;const r=()=>{i++,i===e.length&&(this.shadowRoot.removeEventListener("transitionend",r),this._animations.clear(),this.requestUpdate(),this.dispatchEvent(new CustomEvent("move-end",{bubbles:!0,detail:{oldPosition:me(t),newPosition:me(s)}})))};this.shadowRoot.addEventListener("transitionend",r),this._animations.clear();for(const t of e)"add"===t.type||"add-start"===t.type?this._animations.set(t.square,Object.assign(Object.assign({},t),{type:"add-start"})):"move"===t.type||"move-start"===t.type?this._animations.set(t.destination,Object.assign(Object.assign({},t),{type:"move-start"})):this._animations.set(t.square,t);this.requestUpdate(),await new Promise(e=>setTimeout(e,0)),this._animations.clear();for(const t of e)"move"===t.type||"move-start"===t.type?this._animations.set(t.destination,t):this._animations.set(t.square,t);this.requestUpdate()}_error(e,t,s){const i=`Chessboard Error ${e} : ${t}`;return this.dispatchEvent(new ErrorEvent("error",{message:i})),new Error(i)}};var Fe;Ie.styles=ve,De([re({converter:e=>Re(e)})],Ie.prototype,"position",null),De([re({attribute:"hide-notation",type:Boolean})],Ie.prototype,"hideNotation",void 0),De([re()],Ie.prototype,"orientation",void 0),De([re({attribute:"draggable-pieces",type:Boolean})],Ie.prototype,"draggablePieces",void 0),De([re({attribute:"drop-off-board"})],Ie.prototype,"dropOffBoard",void 0),De([re({attribute:"piece-theme"})],Ie.prototype,"pieceTheme",void 0),De([re({attribute:"move-speed"})],Ie.prototype,"moveSpeed",void 0),De([re({attribute:"snapback-speed"})],Ie.prototype,"snapbackSpeed",void 0),De([re({attribute:"snap-speed"})],Ie.prototype,"snapSpeed",void 0),De([re({attribute:"trash-speed"})],Ie.prototype,"trashSpeed",void 0),De([re({attribute:"appear-speed"})],Ie.prototype,"appearSpeed",void 0),De([re({attribute:"spare-pieces",type:Boolean})],Ie.prototype,"sparePieces",void 0),De([(Fe='[part~="dragged-piece"]',(e,t)=>{const s={get(){return this.renderRoot.querySelector(Fe)},enumerable:!0,configurable:!0};return void 0!==t?ne(s,e,t):oe(s,e)})],Ie.prototype,"_draggedPieceElement",void 0),Ie=De([(e=>t=>"function"==typeof t?((e,t)=>(window.customElements.define(e,t),t))(e,t):((e,t)=>{const{kind:s,elements:i}=t;return{kind:s,elements:i,finisher(t){window.customElements.define(e,t)}}})(e,t))("chess-board")],Ie);export{Pe as COLUMNS,Ie as ChessBoardElement,ye as START_FEN,Oe as START_POSITION,Se as blackPieces,Be as calculatePositionFromMoves,Te as fenToObj,Ve as findClosestPiece,we as getSquareColor,Re as normalizePozition,Ae as objToFen,Ce as validFen,qe as validMove,Ee as validPieceCode,Ne as validPositionObject,xe as validSquare,be as whitePieces};
